<div class="dashboard-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="database-management">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Database Management</h1>
      <p>Manage your database connections and configurations</p>
    </div>
    <button
      class="btn btn-primary"
      (click)="toggleCreateForm()"
      [disabled]="isLoading">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      {{ showCreateForm ? 'Cancel' : 'Add Database' }}
    </button>
  </div>

  <!-- Message Alert -->
  <div *ngIf="message" class="alert" [class.alert-success]="messageType === 'success'" [class.alert-error]="messageType === 'error'">
    <div class="alert-content">
      <svg *ngIf="messageType === 'success'" width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
      </svg>
      <svg *ngIf="messageType === 'error'" width="20" height="20" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
        <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>{{ message }}</span>
    </div>
  </div>

  <!-- Create Database Form -->
  <div *ngIf="showCreateForm" class="create-form-container">
    <div class="form-card">
      <h2>Create New Database Connection</h2>
      <form [formGroup]="createDatabaseForm" (ngSubmit)="onSubmit()">
        <!-- Database Type -->
        <div class="form-group">
          <label for="databaseType">Database Type *</label>
          <select
            id="databaseType"
            formControlName="databaseType"
            class="form-control"
            [class.error]="getFieldError('databaseType')">
            <option *ngFor="let type of databaseTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <div *ngIf="getFieldError('databaseType')" class="error-message">
            {{ getFieldError('databaseType') }}
          </div>
        </div>

        <!-- Connection String -->
        <div class="form-group">
          <label for="connectionString">Connection String *</label>
          <textarea
            id="connectionString"
            formControlName="connectionString"
            class="form-control"
            [class.error]="getFieldError('connectionString')"
            placeholder="e.g., mysql://root:password&#64;localhost:3306/database_name"
            rows="3"></textarea>
          <div *ngIf="getFieldError('connectionString')" class="error-message">
            {{ getFieldError('connectionString') }}
          </div>
          <small class="form-hint">
            Enter the full connection string for your database
          </small>
        </div>

        <!-- Database Name -->
        <div class="form-group">
          <label for="databaseName">Database Name *</label>
          <input
            type="text"
            id="databaseName"
            formControlName="databaseName"
            class="form-control"
            [class.error]="getFieldError('databaseName')"
            placeholder="Enter database name">
          <div *ngIf="getFieldError('databaseName')" class="error-message">
            {{ getFieldError('databaseName') }}
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isCreating || !createDatabaseForm.valid">
            <svg *ngIf="!isCreating" width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" stroke="currentColor" stroke-width="2"/>
              <polyline points="17,21 17,13 7,13 7,21" stroke="currentColor" stroke-width="2"/>
              <polyline points="7,3 7,8 15,8" stroke="currentColor" stroke-width="2"/>
            </svg>
            <div *ngIf="isCreating" class="spinner"></div>
            Create Database
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Databases List -->
  <div class="databases-container">
    <div class="section-header">
      <h2>Your Databases</h2>
      <span class="database-count">{{ databases.length }} database(s)</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner large"></div>
      <p>Loading databases...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && databases.length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
        <ellipse cx="12" cy="5" rx="9" ry="3" stroke="currentColor" stroke-width="2"/>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" stroke="currentColor" stroke-width="2"/>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" stroke="currentColor" stroke-width="2"/>
      </svg>
      <h3>No databases found</h3>
      <p>Create your first database connection to get started</p>
    </div>

    <!-- Databases Grid -->
    <div *ngIf="!isLoading && databases.length > 0" class="databases-grid">
      <div *ngFor="let database of databases" class="database-card">
        <div class="database-header">
          <div class="database-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <ellipse cx="12" cy="5" rx="9" ry="3" stroke="currentColor" stroke-width="2"/>
              <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" stroke="currentColor" stroke-width="2"/>
              <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="database-info">
            <h3>{{ database.name || database.databaseName }}</h3>
            <span class="database-type">{{ (database.type || database.databaseType)?.toUpperCase() }}</span>
          </div>
        </div>

        <div class="database-details">
          <div class="detail-item" *ngIf="database.connectionString">
            <span class="label">Connection:</span>
            <span class="value">{{ database.connectionString | slice:0:50 }}{{ database.connectionString && database.connectionString.length > 50 ? '...' : '' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Database ID:</span>
            <span class="value">{{ database.id }}</span>
          </div>
          <div class="detail-item" *ngIf="database.createdAt">
            <span class="label">Created:</span>
            <span class="value">{{ formatDate(database.createdAt) }}</span>
          </div>
          <div class="detail-item" *ngIf="database.lastSchemaUpdate">
            <span class="label">Last Update:</span>
            <span class="value">{{ formatDate(database.lastSchemaUpdate) }}</span>
          </div>
        </div>

        <div class="database-actions">
          <button class="btn btn-sm btn-outline">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
            </svg>
            Edit
          </button>
          <button class="btn btn-sm btn-outline-danger">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2"/>
            </svg>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
    </div>
  </main>
</div>
